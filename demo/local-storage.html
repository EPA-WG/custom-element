<!DOCTYPE html>
<html lang="en" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:html="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>custom-element Declarative Custom Element implementation demo</title>
    <script type="module" src="../local-storage.js"></script>
    <script type="module" src="../custom-element.js"></script>
    <style>
        body,nav{ display: flex; flex-wrap: wrap; align-content: stretch; gap: 1rem; }
        nav{ flex-direction: column;}
        dce-link,dce-1-slot,dce-2-slot,dce-3-slot,dce-4-slot,dce-2-slots,greet-element,pokemon-tile
            { box-shadow: 0 0 0.5rem lime; padding: 1rem; display: inline-block;}
        dd{ padding: 1rem;}
        p{ margin: 0;}
        table{ min-width: 16rem; }
        tr td{ border-bottom: 1px solid silver; text-align: right; }
        caption{ padding: 1rem; font-weight: bolder; font-family: sans-serif; }
    </style>
</head>
<body>


<!--<html-demo-element legend="1. localStorage simplest"-->
<!--                   description="local-storage read only during initial and only render, does not track the changes.">-->
<!--    <p>Has to produce 12ğŸ’</p>-->
<!--    <template>-->
<!--        <custom-element tag="dce-1" hidden>-->
<!--            <xsl:value-of select="//slice/fruits/text()"></xsl:value-of>-->
<!--           <slot>ğŸ¤”</slot>-->
<!--            <local-storage key="cherries" slice="fruits"></local-storage>-->
<!--        </custom-element>-->
<!--        <dce-1>ğŸ’</dce-1>-->
<!--    </template>-->
<!--</html-demo-element>-->

<!--<html-demo-element legend="2. localStorage JSON"-->
<!--                   description="local-storage read only during initial and only render, does not track the changes.">-->
<!--    <p>Has to produce 12ğŸ’</p>-->
<!--    <template>-->
<!--        <custom-element tag="dce-2" hidden>-->
<!--            <xsl:for-each select="//slice/basket/@*">-->
<!--                <xsl:value-of select="local-name()"/>-->
<!--            </xsl:for-each>-->
<!--           <slot>ğŸ¤”</slot>-->
<!--            count:<xsl:value-of select="count(//slice/basket/@*)"/>-->

<!--            <local-storage key="basket" slice="basket"></local-storage>-->
<!--        </custom-element>-->
<!--        <dce-2>ğŸ’</dce-2>-->
<!--    </template>-->
<!--</html-demo-element>-->

<custom-element tag="dce-2" hidden>
    <local-storage key="basket" slice="basket"></local-storage>
    <html:table>
        <xsl:for-each select="//slice/basket/@*">
            <html:tr>
                <html:th><xsl:value-of select="name()"/></html:th>
                <html:td><xsl:value-of select="."/></html:td>
            </html:tr>
        </xsl:for-each>
    </html:table>
   <slot>ğŸ¤”</slot>
    count:<xsl:value-of select="count(//slice/basket/@*)"/>
</custom-element>
<dce-2>ğŸ’</dce-2>

<!--<html-demo-element legend="1. localStorage"-->
<!--                   description="the key comes from ID">-->
<!--    <template>-->
<!--        <custom-element tag="local-storage-demo1" hidden>-->
<!--            <slot> Hello </slot> World!-->
<!--            <xsl:value-of select="slice/data-{//id}"/>-->
<!--        </custom-element>-->
<!--        <local-storage-demo1 id="dce1"><i>ğŸ‹</i></local-storage-demo1>-->
<!--        <local-storage-demo1 id="dce2"><i>ğŸ’</i></local-storage-demo1>-->
<!--    </template>-->
<!--</html-demo-element>-->
<fieldset>
    <legend>Click to increment the localStorage value</legend>
    <p>The demo should display count 1ğŸ‹ and 12ğŸ’ initially.
        The value in <code>localStorage</code> is incremented
        when clicked on matching button
    </p>
    <button id="btn1" name="lemons" value="1">ğŸ‹</button>
    <button id="btn2" name="cherries" value="12">ğŸ’</button>
    <table>
        <caption> localStorage content </caption>
        <thead><tr><th>key</th><th>value</th></tr></thead>
        <tbody id="local-storage-values"></tbody>
    </table>
</fieldset>
<script type="module">
    import $ from 'https://unpkg.com/css-chain@1/CssChain.js';

    const basket = {cherries: 12, lemons:1 };
    localStorage.setItem( 'basket', JSON.stringify(basket) );

    $('button[name]')
        .forEach( b=> localStorage.setItem( b.name, b.value ) )
        .addEventListener( 'click', e =>
        {   const k = e.target.name;
            localStorage.setItem( k, basket[k] = 1+1*localStorage[k] )
            localStorage.setItem( 'basket', JSON.stringify(basket) );
        } );

    const renderStorage = () =>
        window[ 'local-storage-values' ].innerHTML = [...Array(localStorage.length).keys()]
            .map( k => `<tr><th>${ localStorage.key(k) }</th><td>${ localStorage.getItem( localStorage.key(k) ) }</td>` ).join( '\n' );

    window.addEventListener( 'storage', renderStorage );
    window.addEventListener( 'local-storage', renderStorage );
    renderStorage();

const originalSetItem = localStorage.setItem;
localStorage.setItem = function( key, value, ...rest )
    {   originalSetItem.apply(this, [ key, value, ...rest ]);
        window.dispatchEvent( new CustomEvent('local-storage',{detail:{key,value}}) );
    };

</script>

<script type="module" src="https://unpkg.com/html-demo-element@1.0/html-demo-element.js"></script>

</body>
</html>
