<!DOCTYPE html>
<html lang="en" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:html="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>custom-element Declarative Custom Element implementation demo</title>
    <link rel="icon" href="./wc-square.svg" />
    <script type="module" src="../local-storage.js"></script>
    <script type="module" src="../custom-element.js"></script>
    <style>
        @import "./demo.css";

        button{ background: forestgreen; }
        table{ min-width: 16rem; }
        td{ border-bottom: 1px solid silver; }
        tfoot td{ border-bottom: none; }
        td,th{text-align: right; }
        caption{ padding: 1rem; font-weight: bolder; font-family: sans-serif; }
    </style>
</head>
<body>

<nav>
    <a href=".."><h3><code>custom-element</code> demo</h3></a>
</nav>

<html-demo-element legend="1. localStorage simplest"
                   description="local-storage read only during initial and only render, does not track the changes.">
    <p>Has to produce 12🍒</p>
    <template>
        <custom-element tag="dce-1" hidden>
            <xsl:value-of select="//slice/fruits/text()"></xsl:value-of>
           <slot>🤔</slot>
            <local-storage key="cherries" slice="fruits"></local-storage>
        </custom-element>
        <dce-1>🍒</dce-1>
    </template>
</html-demo-element>

<html-demo-element legend="2. localStorage basket JSON "
                   description="local-storage tracks changes">
    <p>Click the fruits button to add into cart </p>
    <template>
        <custom-element tag="dce-2" hidden>
            <local-storage key="basket" slice="basket" live type="json"></local-storage>
            <html:table>
                <xsl:for-each select="//slice/basket/@*">
                    <html:tr>
                        <html:th><xsl:value-of select="name()"/></html:th>
                        <html:td><xsl:value-of select="."/></html:td>
                    </html:tr>
                </xsl:for-each>
                <html:tfoot>
                    <html:tr>
                        <html:td><slot>🤔</slot></html:td>
                        <html:th><xsl:value-of select="sum(//slice/basket/@*)"/></html:th>
                    </html:tr>
                </html:tfoot>
            </html:table>
        </custom-element>
        <dce-2>🛒total</dce-2>
    </template>
</html-demo-element>

<fieldset>
    <legend>localStorage content</legend>
    <p>The demo should display count 1🍋 and 12🍒 initially.
        The value in <code>localStorage</code> is incremented
        when clicked on matching button
    </p>
    <button name="lemons" value="1"     >🍋</button>
    <button name="cherries" value="12"  >🍒</button>
    <button name="apple"                >🍏</button>
    <button name="banana"               >🍌</button>
    <table>
        <caption> Click to add the localStorage value </caption>
        <thead><tr><th>key</th><th>value</th></tr></thead>
        <tbody id="local-storage-values"></tbody>
    </table>
</fieldset>
<script type="module">
    import $ from 'https://unpkg.com/css-chain@1/CssChain.js';

    const basket = {cherries: 12, lemons:1 };
    localStorage.setItem( 'basket', JSON.stringify(basket) );

    $('button[name]')
        .forEach( b=> localStorage.setItem( b.name, b.value ) )
        .addEventListener( 'click', e =>
        {   const k = e.target.name;
            basket[k] || (basket[k] = 1);
            localStorage.setItem( k, basket[k] = 1+1*localStorage[k] )
            localStorage.setItem( 'basket', JSON.stringify(basket) );
        } );

    const renderStorage = () =>
        window[ 'local-storage-values' ].innerHTML = [...Array(localStorage.length).keys()]
            .map( k => `<tr><th>${ localStorage.key(k) }</th><td>${ localStorage.getItem( localStorage.key(k) ) }</td>` ).join( '\n' );

    window.addEventListener( 'storage', renderStorage );
    window.addEventListener( 'local-storage', renderStorage );
    renderStorage();
</script>

<script type="module" src="https://unpkg.com/html-demo-element@1/html-demo-element.js"></script>

</body>
</html>
